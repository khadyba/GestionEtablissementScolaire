{
    "sourceFile": "app/Http/Controllers/AdministrateurController.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 13,
            "patches": [
                {
                    "date": 1728140094485,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1728979577128,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -37,13 +37,13 @@\n         $classeId = $classeId ? $classeId->id : null;\n         return view('Administrateur.admindashboard',compact('elevesInscrits','emploisDuTemps','classeId'));\n     }\n \n-    public function listeElevesInscrits()\n-    {\n-        $elevesInscrits = Payment::where('statut', 1)->with('eleve')->get();\n-        return view('Administrateur.admindashboard', compact('elevesInscrits'));\n-    }\n+    // public function listeElevesInscrits()\n+    // {\n+    //     $elevesInscrits = Payment::where('statut', 1)->with('eleve')->get();\n+    //     return view('Administrateur.admindashboard', compact('elevesInscrits'));\n+    // }\n     // $emploisDuTemps = EmploisDuTemps::all();\n     /**\n      * Show the form for creating a new resource.\n      *\n"
                },
                {
                    "date": 1728979594796,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -42,8 +42,33 @@\n     // {\n     //     $elevesInscrits = Payment::where('statut', 1)->with('eleve')->get();\n     //     return view('Administrateur.admindashboard', compact('elevesInscrits'));\n     // }\n+    public function listeElevesInscrits()\n+{\n+    // Récupère les élèves inscrits dans les établissements privés (toutes les inscriptions)\n+    $elevesPrives = Payment::where('statut', 1)\n+                            ->whereHas('eleve.etablissement', function($query) {\n+                                $query->where('type', 'privé'); // Assurez que le type est correct\n+                            })\n+                            ->with('eleve')\n+                            ->get();\n+\n+    // Récupère un seul élève par établissement public (par exemple le plus récent)\n+    $elevesPublics = Payment::where('statut', 1)\n+                            ->whereHas('eleve.etablissement', function($query) {\n+                                $query->where('type', 'public');\n+                            })\n+                            ->with('eleve')\n+                            ->groupBy('eleve_id') // Éviter les doublons d'élèves dans les établissements publics\n+                            ->get();\n+\n+    // Fusionner les deux collections\n+    $elevesInscrits = $elevesPrives->merge($elevesPublics);\n+\n+    return view('Administrateur.admindashboard', compact('elevesInscrits'));\n+}\n+\n     // $emploisDuTemps = EmploisDuTemps::all();\n     /**\n      * Show the form for creating a new resource.\n      *\n"
                },
                {
                    "date": 1728980480760,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -46,9 +46,9 @@\n     public function listeElevesInscrits()\n {\n     // Récupère les élèves inscrits dans les établissements privés (toutes les inscriptions)\n     $elevesPrives = Payment::where('statut', 1)\n-                            ->whereHas('eleve.etablissement', function($query) {\n+                            ->whereHas('eleves.etablissement', function($query) {\n                                 $query->where('type', 'privé'); // Assurez que le type est correct\n                             })\n                             ->with('eleve')\n                             ->get();\n"
                },
                {
                    "date": 1728980487413,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -49,14 +49,14 @@\n     $elevesPrives = Payment::where('statut', 1)\n                             ->whereHas('eleves.etablissement', function($query) {\n                                 $query->where('type', 'privé'); // Assurez que le type est correct\n                             })\n-                            ->with('eleve')\n+                            ->with('eleves')\n                             ->get();\n \n     // Récupère un seul élève par établissement public (par exemple le plus récent)\n     $elevesPublics = Payment::where('statut', 1)\n-                            ->whereHas('eleve.etablissement', function($query) {\n+                            ->whereHas('eleves.etablissement', function($query) {\n                                 $query->where('type', 'public');\n                             })\n                             ->with('eleve')\n                             ->groupBy('eleve_id') // Éviter les doublons d'élèves dans les établissements publics\n"
                },
                {
                    "date": 1728980621712,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -49,17 +49,17 @@\n     $elevesPrives = Payment::where('statut', 1)\n                             ->whereHas('eleves.etablissement', function($query) {\n                                 $query->where('type', 'privé'); // Assurez que le type est correct\n                             })\n-                            ->with('eleves')\n+                            ->with('eleve')\n                             ->get();\n \n     // Récupère un seul élève par établissement public (par exemple le plus récent)\n     $elevesPublics = Payment::where('statut', 1)\n                             ->whereHas('eleves.etablissement', function($query) {\n                                 $query->where('type', 'public');\n                             })\n-                            ->with('eleve')\n+                            ->with('eleves')\n                             ->groupBy('eleve_id') // Éviter les doublons d'élèves dans les établissements publics\n                             ->get();\n \n     // Fusionner les deux collections\n"
                },
                {
                    "date": 1728980629598,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -46,9 +46,9 @@\n     public function listeElevesInscrits()\n {\n     // Récupère les élèves inscrits dans les établissements privés (toutes les inscriptions)\n     $elevesPrives = Payment::where('statut', 1)\n-                            ->whereHas('eleves.etablissement', function($query) {\n+                            ->whereHas('eleve.etablissement', function($query) {\n                                 $query->where('type', 'privé'); // Assurez que le type est correct\n                             })\n                             ->with('eleve')\n                             ->get();\n@@ -57,9 +57,9 @@\n     $elevesPublics = Payment::where('statut', 1)\n                             ->whereHas('eleves.etablissement', function($query) {\n                                 $query->where('type', 'public');\n                             })\n-                            ->with('eleves')\n+                            ->with('eleve')\n                             ->groupBy('eleve_id') // Éviter les doublons d'élèves dans les établissements publics\n                             ->get();\n \n     // Fusionner les deux collections\n"
                },
                {
                    "date": 1728982190305,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -43,32 +43,18 @@\n     //     $elevesInscrits = Payment::where('statut', 1)->with('eleve')->get();\n     //     return view('Administrateur.admindashboard', compact('elevesInscrits'));\n     // }\n     public function listeElevesInscrits()\n-{\n-    // Récupère les élèves inscrits dans les établissements privés (toutes les inscriptions)\n-    $elevesPrives = Payment::where('statut', 1)\n-                            ->whereHas('eleve.etablissement', function($query) {\n-                                $query->where('type', 'privé'); // Assurez que le type est correct\n-                            })\n-                            ->with('eleve')\n-                            ->get();\n+    {\n+        // Charge les paiements, les élèves (via la relation avec User) et l'établissement de l'utilisateur\n+        $elevesInscrits = Payment::where('statut', 1)\n+            ->with(['eleve.user.etablissement']) // Charge l'étudiant, l'utilisateur et l'établissement\n+            ->get();\n+        \n+        return view('Administrateur.admindashboard', compact('elevesInscrits'));\n+    }\n+    \n \n-    // Récupère un seul élève par établissement public (par exemple le plus récent)\n-    $elevesPublics = Payment::where('statut', 1)\n-                            ->whereHas('eleves.etablissement', function($query) {\n-                                $query->where('type', 'public');\n-                            })\n-                            ->with('eleve')\n-                            ->groupBy('eleve_id') // Éviter les doublons d'élèves dans les établissements publics\n-                            ->get();\n-\n-    // Fusionner les deux collections\n-    $elevesInscrits = $elevesPrives->merge($elevesPublics);\n-\n-    return view('Administrateur.admindashboard', compact('elevesInscrits'));\n-}\n-\n     // $emploisDuTemps = EmploisDuTemps::all();\n     /**\n      * Show the form for creating a new resource.\n      *\n"
                },
                {
                    "date": 1728982710849,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -46,14 +46,15 @@\n     public function listeElevesInscrits()\n     {\n         // Charge les paiements, les élèves (via la relation avec User) et l'établissement de l'utilisateur\n         $elevesInscrits = Payment::where('statut', 1)\n-            ->with(['eleve.user.etablissement']) // Charge l'étudiant, l'utilisateur et l'établissement\n+            ->with(['eleve.user.etablissement']) // Charge l'élève, l'utilisateur et l'établissement\n             ->get();\n         \n         return view('Administrateur.admindashboard', compact('elevesInscrits'));\n     }\n     \n+    \n \n     // $emploisDuTemps = EmploisDuTemps::all();\n     /**\n      * Show the form for creating a new resource.\n"
                },
                {
                    "date": 1728982976753,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -53,8 +53,9 @@\n         return view('Administrateur.admindashboard', compact('elevesInscrits'));\n     }\n     \n     \n+    \n \n     // $emploisDuTemps = EmploisDuTemps::all();\n     /**\n      * Show the form for creating a new resource.\n"
                },
                {
                    "date": 1728983105510,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -46,9 +46,9 @@\n     public function listeElevesInscrits()\n     {\n         // Charge les paiements, les élèves (via la relation avec User) et l'établissement de l'utilisateur\n         $elevesInscrits = Payment::where('statut', 1)\n-            ->with(['eleve.user.etablissement']) // Charge l'élève, l'utilisateur et l'établissement\n+            ->with(['eleve.user.etablissement']) \n             ->get();\n         \n         return view('Administrateur.admindashboard', compact('elevesInscrits'));\n     }\n"
                },
                {
                    "date": 1728984836616,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -44,18 +44,19 @@\n     //     return view('Administrateur.admindashboard', compact('elevesInscrits'));\n     // }\n     public function listeElevesInscrits()\n     {\n-        // Charge les paiements, les élèves (via la relation avec User) et l'établissement de l'utilisateur\n+        // Charge les paiements et les élèves (via la relation avec User et Etablissement)\n         $elevesInscrits = Payment::where('statut', 1)\n-            ->with(['eleve.user.etablissement']) \n+            ->with(['eleve.user.etablissement']) // Charge l'élève, l'utilisateur et l'établissement\n             ->get();\n         \n         return view('Administrateur.admindashboard', compact('elevesInscrits'));\n     }\n     \n     \n     \n+    \n \n     // $emploisDuTemps = EmploisDuTemps::all();\n     /**\n      * Show the form for creating a new resource.\n"
                },
                {
                    "date": 1728985733431,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -37,13 +37,9 @@\n         $classeId = $classeId ? $classeId->id : null;\n         return view('Administrateur.admindashboard',compact('elevesInscrits','emploisDuTemps','classeId'));\n     }\n \n-    // public function listeElevesInscrits()\n-    // {\n-    //     $elevesInscrits = Payment::where('statut', 1)->with('eleve')->get();\n-    //     return view('Administrateur.admindashboard', compact('elevesInscrits'));\n-    // }\n+ \n     public function listeElevesInscrits()\n     {\n         // Charge les paiements et les élèves (via la relation avec User et Etablissement)\n         $elevesInscrits = Payment::where('statut', 1)\n"
                },
                {
                    "date": 1731405045962,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -210,9 +210,9 @@\n {\n     $professeur = auth()->user()->professeur;\n     $classe = Classe::findOrFail($id);\n     $cours = Cours::where('classe_id', $id)->where('is_deleted', false)->get();\n-    return view('Administrateur.Classe.courList', compact('classe', 'cours'));\n+    return view('Administrateur.Classe.CourList', compact('classe', 'cours'));\n }\n \n public function destroyProfessor($id)\n {\n"
                }
            ],
            "date": 1728140094485,
            "name": "Commit-0",
            "content": "<?php\n\nnamespace App\\Http\\Controllers;\n\nuse App\\Models\\User;\nuse App\\Models\\Cours;\nuse App\\Models\\Classe;\nuse App\\Models\\Payment;\nuse Illuminate\\Support\\Str;\nuse Illuminate\\Http\\Request;\nuse App\\Models\\Etablissement;\nuse App\\Models\\Administrateur;\nuse App\\Models\\EmploisDuTemps;\nuse App\\Mail\\NouveauCompteMail;\nuse Illuminate\\Support\\Facades\\DB;\nuse Illuminate\\Support\\Facades\\Auth;\nuse Illuminate\\Support\\Facades\\Hash;\nuse Illuminate\\Support\\Facades\\Mail;\nuse App\\Http\\Requests\\AjoutProfRequest;\nuse App\\Http\\Requests\\AdminRegisterRequest;\n\nclass AdministrateurController extends Controller\n{\n    /**\n     * Display a listing of the resource.\n     *\n     * @return \\Illuminate\\Http\\Response\n     */\n    public function index()\n    {\n        $elevesInscrits = Payment::where('statut', 1)\n        ->with('eleve')\n        ->get()\n        ->unique('eleve_id');\n        $emploisDuTemps = EmploisDuTemps::all();\n        $classeId = Classe::first();\n        $classeId = $classeId ? $classeId->id : null;\n        return view('Administrateur.admindashboard',compact('elevesInscrits','emploisDuTemps','classeId'));\n    }\n\n    public function listeElevesInscrits()\n    {\n        $elevesInscrits = Payment::where('statut', 1)->with('eleve')->get();\n        return view('Administrateur.admindashboard', compact('elevesInscrits'));\n    }\n    // $emploisDuTemps = EmploisDuTemps::all();\n    /**\n     * Show the form for creating a new resource.\n     *\n     * @return \\Illuminate\\Http\\Response\n     */\n    public function create()\n    {\n        return view('Administrateur.formulaireAdministrateur');\n    }\n\n\n    public function listProfessors()\n    {\n       \n        $professeurs = User::whereHas('roles', function($query) {\n            $query->where('nom', 'professeurs');\n        })->where('is_completed', false)->get();\n\n        return view('Administrateur.Professeurs.list', compact('professeurs'));\n    }\n    /**\n     * Store a newly created resource in storage.\n     *\n     * @param  \\Illuminate\\Http\\Request  $request\n     * @return \\Illuminate\\Http\\Response\n     */\n    public function store(AdminRegisterRequest $request)\n    {\n        $validatedData = $request->validated();\n        $validatedData['password'] = Hash::make($validatedData['password']);\n\n        Administrateur::create($validatedData);\n        return redirect()->route('admin.login')->with('success', 'Inscription réussie, veuillez vous connecter !');\n    }\n\n    /**\n     * Display the specified resource.\n     *\n     * @param  \\App\\Models\\Administrateur  $administrateur\n     * @return \\Illuminate\\Http\\Response\n     */\n    public function show(Administrateur $administrateur)\n    {\n        //\n    }\n\n    /**\n     * Show the form for editing the specified resource.\n     *\n     * @param  \\App\\Models\\Administrateur  $administrateur\n     * @return \\Illuminate\\Http\\Response\n     */\n    public function edit(Administrateur $administrateur)\n    \n       \n        {\n            $admin = auth()->user();\n            return view('Administrateur.updateProfil', compact('admin'));\n        }\n    \n\n    /**\n     * Update the specified resource in storage.\n     *\n     * @param  \\Illuminate\\Http\\Request  $request\n     * @param  \\App\\Models\\Administrateur  $administrateur\n     * @return \\Illuminate\\Http\\Response\n     */\n    public function update(Request $request, Administrateur $administrateur)\n    {\n        $admin = Administrateur::find(auth()->id()); \n\n        $validatedData = $request->validate([\n            'adresse' => 'required|string|max:255',\n            'telephone' => 'required|string|max:20',\n            'email' => 'required|email|max:255',\n        ]);\n    \n        $admin->adresse = $validatedData['adresse'];\n        $admin->telephone = $validatedData['telephone'];\n        $admin->email = $validatedData['email'];\n\n        $admin->save();\n    \n        return redirect()->route('admin.profile.edit')->with('success', 'Profil mis à jour avec succès.');\n    }\n\n    /**\n     * Remove the specified resource from storage.\n     *\n     * @param  \\App\\Models\\Administrateur  $administrateur\n     * @return \\Illuminate\\Http\\Response\n     */\n    public function destroy(Administrateur $administrateur)\n    {\n        //\n    }\n      public function formulaire()\n      {\n        $etablissements = Etablissement::all(); \n        return view('Administrateur.formulaireAjouProf', compact('etablissements'));\n      }\n\n    public function ajouterProfesseur(AjoutProfRequest $request)\n    {\n        $validatedData = $request->validated();\n\n    if (empty($validatedData['password'])) {\n        $validatedData['password'] = Str::random(8);\n    }\n    $hashedPassword = Hash::make($validatedData['password']);\n\n    // Création d'un nouvel utilisateur avec les données validées\n    $user = User::create([\n        'email' => $validatedData['email'],\n        'password' => $hashedPassword,\n        'etablissement_id' => $validatedData['etablissement_id'],\n    ]);\n    $roleId = null;\n    switch ($request->typecompte) {\n        case 'professeurs':\n            $roleId = 1;\n            break;\n        case 'eleves':\n            $roleId = 2;\n            break;\n        case 'parents':\n            $roleId = 3;\n            break;\n    }\n    if ($roleId) {\n        DB::table('usersroles')->insert([\n            'user_id' => $user->id,\n            'role_id' => $roleId,\n        ]);\n    }\n\n   \n    $identifiants = [\n        'email' => $validatedData['email'],\n        'password' => $validatedData['password'],\n    ];\n\n    Mail::to($validatedData['email'])->send(new NouveauCompteMail($identifiants));\n    // Redirection avec un message de succès et les identifiants\n    return redirect()->route('list.index')->with([\n        'success' => 'Utilisateur créé avec succès.',\n        'identifiants' => $identifiants,\n    ]);\n}\n\n\npublic function listeCours($id) \n{\n    $professeur = auth()->user()->professeur;\n    $classe = Classe::findOrFail($id);\n    $cours = Cours::where('classe_id', $id)->where('is_deleted', false)->get();\n    return view('Administrateur.Classe.courList', compact('classe', 'cours'));\n}\n\npublic function destroyProfessor($id)\n{\n    $professeur = User::find($id);\n\n    if ($professeur) {\n        $professeur->is_completed = true;\n        $professeur->save();\n        return redirect()->route('professeurs.list')->with('success', 'Le compte du professeur a été désactivé avec succès.');\n    }\n\n    return redirect()->route('professeurs.list')->with('error', 'Le professeur n\\'a pas été trouvé.');\n}\n\n\n}"
        }
    ]
}