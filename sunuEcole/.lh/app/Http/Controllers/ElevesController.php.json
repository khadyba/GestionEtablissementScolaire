{
    "sourceFile": "app/Http/Controllers/ElevesController.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 4,
            "patches": [
                {
                    "date": 1727204491137,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1727204557334,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -69,9 +69,9 @@\n         $eleve->adresse = $validated['adresse'];\n         $eleve->non_de_votre_tuteur = $validated['non_de_votre_tuteur'];\n         $eleve->email_tuteur = $validated['email_tuteur'];\n         $eleve->dateDeNaissance = $validated['dateDeNaissance'];\n-        $eleve->classe_id = $validated['classe_id'];\n+        $eleve->classe_id = $validated['classes_id'];\n         $eleve->parent_id = $validated['parent_id'];\n         $eleve->user_id = $user->id; \n         $eleve->is_completed = true;\n         $eleve->save();\n"
                },
                {
                    "date": 1727204584437,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -69,9 +69,9 @@\n         $eleve->adresse = $validated['adresse'];\n         $eleve->non_de_votre_tuteur = $validated['non_de_votre_tuteur'];\n         $eleve->email_tuteur = $validated['email_tuteur'];\n         $eleve->dateDeNaissance = $validated['dateDeNaissance'];\n-        $eleve->classe_id = $validated['classes_id'];\n+        $eleve->classes_id = $validated['classes_id'];\n         $eleve->parent_id = $validated['parent_id'];\n         $eleve->user_id = $user->id; \n         $eleve->is_completed = true;\n         $eleve->save();\n"
                },
                {
                    "date": 1727204707009,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -69,9 +69,9 @@\n         $eleve->adresse = $validated['adresse'];\n         $eleve->non_de_votre_tuteur = $validated['non_de_votre_tuteur'];\n         $eleve->email_tuteur = $validated['email_tuteur'];\n         $eleve->dateDeNaissance = $validated['dateDeNaissance'];\n-        $eleve->classes_id = $validated['classes_id'];\n+        $eleve->classe_id = $validated['classes_id'];\n         $eleve->parent_id = $validated['parent_id'];\n         $eleve->user_id = $user->id; \n         $eleve->is_completed = true;\n         $eleve->save();\n"
                },
                {
                    "date": 1727206027478,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -69,10 +69,9 @@\n         $eleve->adresse = $validated['adresse'];\n         $eleve->non_de_votre_tuteur = $validated['non_de_votre_tuteur'];\n         $eleve->email_tuteur = $validated['email_tuteur'];\n         $eleve->dateDeNaissance = $validated['dateDeNaissance'];\n-        $eleve->classe_id = $validated['classes_id'];\n-        $eleve->parent_id = $validated['parent_id'];\n+        $eleve->classe_id = $validated['classe_id'];\n         $eleve->user_id = $user->id; \n         $eleve->is_completed = true;\n         $eleve->save();\n         return redirect()->route('eleves.dashboard')->with('success', 'Profil complété avec succès.');\n"
                }
            ],
            "date": 1727204491137,
            "name": "Commit-0",
            "content": "<?php\n\nnamespace App\\Http\\Controllers;\n\nuse App\\Models\\User;\nuse App\\Models\\Cours;\nuse App\\Models\\Classe;\nuse App\\Models\\Eleves;\nuse Illuminate\\Http\\Request;\n\nuse Illuminate\\Support\\Facades\\Auth;\nuse function PHPUnit\\Framework\\returnSelf;\nuse App\\Http\\Requests\\CompleterProfilEleveRequest;\nuse App\\Http\\Requests\\UpdateStudentProfileRequest;\n\nclass ElevesController extends Controller\n{\n    public function __construct()\n    {\n        $this->middleware(['auth', 'student']);\n    }\n    /**\n     * Display a listing of the resource.\n     *\n     * @return \\Illuminate\\Http\\Response\n     */\n    public function index()\n    {\n        $classes = Classe::all();\n        $parents = User::whereHas('roles', function ($query) {\n            $query->where('role_id', 3);\n        })->get();\n        $cours = Cours::all();\n        return view('Eleves.elevesdashboard', compact('classes', 'parents','cours'));\n    }\n     public function completerProfil()\n     {\n        $classes = Classe::all();\n        $parents = User::whereHas('roles', function ($query) {\n            $query->where('role_id', 3);\n        })->get();\n        return view('Eleves.classes.completerProfil',compact('classes','parents'));\n     }\n\n\n    /**\n     * Show the form for creating a new resource.\n     *\n     * @return \\Illuminate\\Http\\Response\n     */\n    public function create()\n    {\n    //    \n    }\n\n    /**\n     * Store a newly created resource in storage.\n     *\n     * @param  \\Illuminate\\Http\\Request  $request\n     * @return \\Illuminate\\Http\\Response\n     */\n    public function store(CompleterProfilEleveRequest $request)\n    {\n        $validated = $request->validated();\n        $user = Auth::user();\n        $eleve = new Eleves();\n        $eleve->nom = $validated['nom'];\n        $eleve->prenoms = $validated['prenoms'];\n        $eleve->adresse = $validated['adresse'];\n        $eleve->non_de_votre_tuteur = $validated['non_de_votre_tuteur'];\n        $eleve->email_tuteur = $validated['email_tuteur'];\n        $eleve->dateDeNaissance = $validated['dateDeNaissance'];\n        $eleve->classe_id = $validated['classe_id'];\n        $eleve->parent_id = $validated['parent_id'];\n        $eleve->user_id = $user->id; \n        $eleve->is_completed = true;\n        $eleve->save();\n        return redirect()->route('eleves.dashboard')->with('success', 'Profil complété avec succès.');\n    }\n    \n\n    public function showBulletin($classeId, $eleveId)\n    {\n        $eleve = Eleves::with('notes.evaluation')->findOrFail($eleveId);\n        $classe = Classe::with('etablissement')->findOrFail($classeId);\n    \n        $totalNotes = 0;\n        $totalCoefficients = 0;\n    \n        foreach ($eleve->notes as $note) {\n            $totalNotes += $note->valeur * $note->coefficient;\n            $totalCoefficients += $note->coefficient;\n        }\n    \n        if ($totalCoefficients > 0) {\n            $moyenne = $totalNotes / $totalCoefficients;\n        } else {\n            $moyenne = 0;\n        }\n    \n        $etablissement = $classe->etablissement;\n    \n        return view('Eleves.Evaluations.BulletinShow', compact('eleve', 'classe', 'etablissement', 'moyenne'));\n    }\n    \n\n    /**\n     * Display the specified resource.\n     *\n     * @param  \\App\\Models\\Eleves  $eleves\n     * @return \\Illuminate\\Http\\Response\n     */\n    public function show(Cours $cours)\n    {\n        $cours=Cours::FindOrfail($cours);\n        return view('Eleves.classes.detailCours',compact('cours'));\n    }\n\n    /**\n     * Show the form for editing the specified resource.\n     *\n     * @param  \\App\\Models\\Eleves  $eleves\n     * @return \\Illuminate\\Http\\Response\n     */\n    public function editProfile(Eleves $eleve)\n    {\n        $eleve = Auth::user()->eleve;\n        return view('Eleves.profileEdit', compact('eleve'));\n    }\n\n    /**\n     * Update the specified resource in storage.\n     *\n     * @param  \\Illuminate\\Http\\Request  $request\n     * @param  \\App\\Models\\Eleves  $eleves\n     * @return \\Illuminate\\Http\\Response\n     */\n    public function updateProfile(UpdateStudentProfileRequest $request, Eleves $eleve)\n    {\n        $user = Auth::user();\n        $eleve = $user->eleve;\n        $data = $request->validated();\n    //     $data = $request->validate([\n    //     'nom' => 'required|string|max:255',\n    //     'prenoms'  =>  'required|string|max:255',\n    //     'adresse'  =>  'required|string|max:255',\n    //     'non_de_votre_tuteur'  =>  'required|string|max:255',\n      \n    // ]);\n\n    $eleve->update($data);\n    return redirect()->route('eleves.profile.edit')->with('success', 'Profil mis à jour avec succès');\n    }\n    \n\n    /**\n     * Remove the specified resource from storage.\n     *\n     * @param  \\App\\Models\\Eleves  $eleves\n     * @return \\Illuminate\\Http\\Response\n     */\n    public function destroy(Eleves $eleves)\n    {\n        //\n    }\n}\n"
        }
    ]
}